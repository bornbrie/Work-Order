// To run via terminal from within vend-oauth-example, use:
//   NODE_ENV=development node node_modules/vend-nodejs-sdk/tests/sample.js
// To run via terminal from within vend-nodejs-sdk, use:
//   NODE_ENV=dev node tests/sample.js

'use strict';

//console.log('process.env.NODE_ENV', process.env.NODE_ENV);
var nconf = require('nconf');
nconf.argv()
  .env()
  .file('config', { file: 'config/' + process.env.NODE_ENV + '.json' })
  .file('oauth', { file: 'oauth.txt' });
//console.log('nconf.get(): ', nconf.get());

var _ = require('underscore');

var vendSdk = require('./../vend')({});


var args = vendSdk.args.products.fetch();
    args.orderBy.value = 'id';
    args.page.value = 1;
    args.pageSize.value = 5;
    args.active.value = true;

    return vendSdk.products.fetch(args, connectionInfo)
      .then(function(response){
        console.log('done\n=====');
        //console.log('response: ', response);
        _.each(response.products, function(product){
          console.log(product.id + ' : ' + product.name);
        });

        // TODO: fetch a product by ID
        var args = vendSdk.args.products.fetchById();
        args.apiId.value = _.last(response.products).id;
        return vendSdk.products.fetchById(
          args,
          connectionInfo
        );
      })
      .then(function(response){
        // TODO: create a dummy customer
        return vendSdk.customers.create(
          {
            'first_name': 'boy',
            'last_name': 'blue',
            'email': 'boy1@blue.com'
          },
          connectionInfo
        );
      })
      .then(function(response){
        console.log('done\n=====');
        console.log('response: ', response);
      });
      /**
       * With Mocha testing framework, a test may return the promise itself.
       * 
       * We donâ€™t need the failure handler or the done callback anymore,
       * as Mocha handles the promise. If the promise fails, Mocha will fail the test.
       * 
       * If you copy/paste code from this test file then
       * adding the following block of code is highly recommended.
       */
      /*.catch(function(e) {
        console.error('sample.js - An unexpected error occurred: ', e);
      });*/


});
